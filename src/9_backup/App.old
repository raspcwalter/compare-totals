"use client"

import { useState } from "react";

import {
  createThirdwebClient,
  getContract,
} from "thirdweb";
import { sepolia } from "thirdweb/chains";
import {
  ConnectButton,
  useReadContract,
} from "thirdweb/react";
import { createWallet } from "thirdweb/wallets";

// import { stringify } from "thirdweb/utils";

//import { toTokens, formatNumber } from "thirdweb/utils";
import { toTokens } from "thirdweb/utils";

//import EnergyConsumptionAnalyzer from "./components/EnergyConsumptionAnalyzer.jsx"

import './App.css'
import logo from "./assets/EnergIA.png";


export const client = createThirdwebClient({
  clientId: "c7062f04495772cb44711c8202c022dc", // replace with your actual ID
});

export const contract = getContract({
  client,
  address: "0x97c4f62fb13bb6e048e661d2d468d0e183911ea7",
  chain: sepolia,
});


function App() {
  const [enabled, setEnabled] = useState(false);
  
//  const [loading, setLoading] = useState(false)
//  const [error, setError] = useState(null)

const [logs, setLogs] = useState([])

  const addLog = (message) => {
    setLogs((prevLogs) => [...prevLogs, { time: new Date().toLocaleTimeString(), message }])
  }

  const clearLogs = () => {
    setLogs([])
  }


  // useReadContract supports an 'enabled' option
  const { data, isLoading, error, refetch } =
    useReadContract({
      contract,
      method:
        "function compareTotals() view returns (uint256 sumTotalValor_, uint256 sumFaturadoConvencional_, uint256 sumFaturadoSCEE_)",
      params: [],
      enabled, // only run when enabled is true
    });

  const labels = [
    "Hourly Tariff Total (R$):",
    "Flat Tariff Total (R$):",
    "Solar PV Total (R$):",
  ];

  const wallets = [createWallet("io.metamask")];



  return (
    <div>
      <img src={logo} alt="logo" width="300 px"></img>
      <h3>
        Nebula powered AI energy retailing back office agent 
      </h3>
         <p>
      This is a MVP for showing the AI agent energy retailing capabilities. 
        </p>
      <ConnectButton
        client={client}
        chain={sepolia}
        wallets={wallets}
        connectModal={{ size: "compact" }}
      />
      <br/>
      <button
        style={{ margin: "2rem 0" }}
        onClick={() => setEnabled(true)}
      >
        Compare Energy Tariff
      </button>
      {enabled && (
        <div>
          {isLoading
            ? "Loading..."
            : error
              ? `Error: ${error.message}`
              : data && (
                  <table
                    style={{
                      borderCollapse: "collapse",
                      minWidth: 330,
                      border: "2px solid #333",
                    }}
                  >
                    <tbody>
                      {labels.map((label, i) => (
                        <tr key={i}>
                          <td
                            style={{
                              border: "1px solid #333",
                              padding: "8px 16px",
                              fontWeight: 600,
                            }}
                          >
                            {label}
                          </td>
                          <td
                            style={{
                              border: "1px solid #333",
                              padding: "8px 16px",
                            }}
                          >
                            {typeof data[i] !== "undefined"
                              ? parseFloat(
                                  toTokens(
                                    BigInt(data[i]),
                                    2,
                                  ),
                                ).toLocaleString(
                                  undefined,
                                  {
                                    minimumFractionDigits: 2,
                                    maximumFractionDigits: 2,
                                  },
                                )
                              : "--"}
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                )}
        </div>
      )}

    {/* letÂ´s create the nebula question  */}
    

{/*     <div className="min-h-screen bg-gray-50 py-8">
      <EnergyConsumptionAnalyzer />
    </div>
 */
 }    </div>

 
  )
}

export default App